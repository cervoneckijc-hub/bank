<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∫–µ–±–µ–¥–µ –ë–∞–Ω–∫ - –ì–æ–ª–æ–≤–Ω–∞</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9; /* Light background for contrast */
            padding-bottom: 70px; /* Space for fixed bottom navigation */
            overflow-x: hidden; /* Prevent body horizontal scroll */
        }
        .skibidi-card {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* –¢—ñ–Ω—å */
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            
            /* –ü—Ä—è–º–æ–∫—É—Ç–Ω–∞ —Ñ–æ—Ä–º–∞: –ø—Ä–∏–±–ª–∏–∑–Ω–æ 16:10 */
            width: 90%; 
            max-width: 350px;
            height: 180px; 
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ –æ–∫–∞ */
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —â–æ–± –∫–∞—Ä—Ç–∫–∞ –±—É–ª–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        .card-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —Å—Ç—Ä—ñ–ª–æ–∫ */
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Å—Ç—Ä—ñ–ª–æ–∫ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó (—Ö–æ—á–∞ –≤–æ–Ω–∏ –≤–∏–¥–∞–ª–µ–Ω—ñ, –∫–ª–∞—Å–∏ –∑–∞–ª–∏—à–∞—î–º–æ –¥–ª—è —á–∏—Å—Ç–æ—Ç–∏) */
        .card-nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.6); /* –ù–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–∏–π —Ñ–æ–Ω */
            color: #374151;
            border-radius: 9999px; /* –ö—Ä—É–≥–ª–∞ —Ñ–æ—Ä–º–∞ */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            z-index: 10;
        }

        .card-nav-arrow:hover {
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: translateY(-50%) scale(1.05);
        }

        .action-button {
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .action-button:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .notification {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        /* Icon styles (using SVG for simplicity) */
        .icon {
            width: 24px;
            height: 24px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        /* Modal Backdrop styles */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            transition: opacity 0.3s ease;
        }
        /* Modal Content animation helper */
        .modal-content-transition {
            transition: transform 0.3s ease-out;
        }

        /* Dark Mode styles (mock implementation) */
        .dark {
            background-color: #1f2937;
            color: #f4f7f9;
        }
        .dark .text-gray-900 { color: #f4f7f9; }
        .dark .text-gray-800 { color: #e5e7eb; }
        .dark .text-gray-700 { color: #d1d5db; }
        .dark .bg-white { background-color: #374151; }
        .dark .bg-white .shadow { box-shadow: none; }
        .dark .bg-white .action-button { background-color: #4b5563; }
        .dark .bg-white .text-gray-600 { color: #d1d5db; }
        .dark .bg-white .text-gray-500 { color: #9ca3af; }
    
        /* Custom colors for cards */
        .bg-card-blue { background: linear-gradient(135deg, #1f2937, #3b82f6); }
        .bg-card-green { background: linear-gradient(135deg, #059669, #10b981); }
        .bg-card-red { background: linear-gradient(135deg, #ef4444, #f97316); }
        .bg-card-purple { background: linear-gradient(135deg, #8b5cf6, #c084fc); }
        
        /* Chat specific styles */
        .chat-container {
            height: 50vh;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        .message-bubble {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 18px;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #3b82f6; 
            color: white;
            border-bottom-right-radius: 4px;
        }
        .manager-message {
            background-color: #e5e7eb; 
            color: #374151;
            border-bottom-left-radius: 4px;
        }
        .dark .manager-message {
             background-color: #4b5563;
             color: #d1d5db;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Main Container -->
    <div id="app" class="max-w-xl mx-auto p-4 sm:p-6">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-extrabold text-gray-900">–®–∫–µ–±–µ–¥–µ –ë–∞–Ω–∫</h1>
            <!-- Profile Button (Dynamic) -->
            <button id="profile-button" onclick="handleProfileClick()" class="p-2 text-gray-600 hover:text-blue-600 transition action-button rounded-full bg-white shadow-md">
                <!-- Icon will be set by JS: User icon (logged in) or Lock icon (logged out) -->
            </button>
        </header>

        <!-- Dynamic Card Placeholder (Centered, Rectangular size) -->
        <div id="card-placeholder" class="mb-8 card-wrapper"> 
            
            <!-- Card Content -->
            <div id="active-card" class="skibidi-card text-white p-5 rounded-xl cursor-grab active:cursor-grabbing">
                <!-- Card content dynamically injected here -->
            </div>
            
        </div>

        <!-- Quick Actions -->
        <h2 class="text-xl font-bold text-gray-800 mb-4">–®–≤–∏–¥–∫—ñ –¥—ñ—ó</h2>
        <div class="grid grid-cols-3 gap-4 mb-8">
            <!-- 1. –ü–µ—Ä–µ–∫–∞–∑ -->
            <button onclick="openModal('transfer')" class="action-button bg-white p-4 rounded-xl shadow hover:shadow-lg flex flex-col items-center">
                <div class="p-3 bg-blue-100 text-blue-600 rounded-full mb-2"><svg class="icon" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg></div>
                <span class="text-sm font-semibold text-gray-700">–ü–µ—Ä–µ–∫–∞–∑</span>
            </button>
            <!-- 2. –û–ø–ª–∞—Ç–∞ -->
            <button onclick="openModal('payment')" class="action-button bg-white p-4 rounded-xl shadow hover:shadow-lg flex flex-col items-center">
                <div class="p-3 bg-green-100 text-green-600 rounded-full mb-2"><svg class="icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></div>
                <span class="text-sm font-semibold text-gray-700">–û–ø–ª–∞—Ç–∞</span>
            </button>
            <!-- 3. –ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è -->
            <button onclick="openModal('replenish')" class="action-button bg-white p-4 rounded-xl shadow hover:shadow-lg flex flex-col items-center">
                <div class="p-3 bg-red-100 text-red-600 rounded-full mb-2"><svg class="icon" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></div>
                <span class="text-sm font-semibold text-gray-700">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏</span>
            </button>
            <!-- 4. –ë—ñ–ª—å—à–µ (–Ü–Ω—Ñ–æ) -->
            <button onclick="openModal('otherinfo')" class="action-button bg-white p-4 rounded-xl shadow hover:shadow-lg flex flex-col items-center">
                <div class="p-3 bg-purple-100 text-purple-600 rounded-full mb-2"><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg></div>
                <span class="text-sm font-semibold text-gray-700">–Ü–Ω—Ñ–æ</span>
            </button>
            <!-- 5. –ö—Ä–µ–¥–∏—Ç -->
            <button onclick="openCreditModal()" class="action-button bg-white p-4 rounded-xl shadow hover:shadow-lg flex flex-col items-center">
                <div class="p-3 bg-indigo-100 text-indigo-600 rounded-full mb-2"><svg class="icon" viewBox="0 0 24 24"><path d="M10 20H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10l6 6v8a2 2 0 0 1-2 2z"></path><path d="M15 15a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2z"></path></svg></div>
                <span class="text-sm font-semibold text-gray-700">–ö—Ä–µ–¥–∏—Ç</span>
            </button>
            <!-- 6. –î–µ–ø–æ–∑–∏—Ç -->
            <button onclick="openModal('deposit')" class="action-button bg-white p-4 rounded-xl shadow hover:shadow-lg flex flex-col items-center">
                <div class="p-3 bg-yellow-100 text-yellow-600 rounded-full mb-2"><svg class="icon" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div>
                <span class="text-sm font-semibold text-gray-700">–î–µ–ø–æ–∑–∏—Ç</span>
            </button>
        </div>

        <!-- Transaction History (Limited preview) -->
        <h2 class="text-xl font-bold text-gray-800 mb-4">–û—Å—Ç–∞–Ω–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</h2>
        <div id="transactions-list" class="space-y-3 bg-white p-4 rounded-xl shadow">
            <!-- Transactions will be rendered here -->
        </div>
        
    </div>

    <!-- ---------------------------------------------------------------------- -->
    <!-- MOCK MODALS CONTAINER -->
    <!-- ---------------------------------------------------------------------- -->

    <div id="modal-container" class="fixed inset-0 flex items-end justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300 modal-backdrop">
        
        <!-- 1.3. DEPOSIT MODAL -->
        <div id="deposit-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="deposit">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–í—ñ–¥–∫—Ä–∏—Ç—Ç—è –î–µ–ø–æ–∑–∏—Ç—É</h3>
            
            <p class="text-sm text-gray-600 mb-4">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ä—Ç–∫—É –¥–ª—è —Å–ø–∏—Å–∞–Ω–Ω—è –∫–æ—à—Ç—ñ–≤: <span class="font-semibold text-blue-600">${cards[activeCardIndex]?.name || '–ù/–î'}</span></p>

            <form onsubmit="handleDepositSubmit(event)">
                <div class="mb-4">
                    <label for="deposit-amount" class="block text-sm font-medium text-gray-700 mb-1">–°—É–º–∞ –î–µ–ø–æ–∑–∏—Ç—É (–º—ñ–Ω. 1000 –≥—Ä–Ω)</label>
                    <input type="number" step="100" min="1000" id="deposit-amount" name="amount" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 10000" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" oninput="calculateDeposit()">
                </div>
                <div class="mb-4">
                    <label for="deposit-term" class="block text-sm font-medium text-gray-700 mb-1">–¢–µ—Ä–º—ñ–Ω (–º—ñ—Å—è—Ü—ñ–≤)</label>
                    <select id="deposit-term" name="term" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 bg-white" onchange="calculateDeposit()">
                        <option value="6">6 –º—ñ—Å—è—Ü—ñ–≤ (10% —Ä—ñ—á–Ω–∏—Ö)</option>
                        <option value="12">12 –º—ñ—Å—è—Ü—ñ–≤ (11% —Ä—ñ—á–Ω–∏—Ö)</option>
                        <option value="24">24 –º—ñ—Å—è—Ü—ñ (12% —Ä—ñ—á–Ω–∏—Ö)</option>
                    </select>
                </div>
                
                <!-- Calculation Result -->
                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-6">
                    <p class="font-semibold text-gray-800 mb-2">–ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥—É (–ú–æ–∫):</p>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">–û—á—ñ–∫—É–≤–∞–Ω–∏–π –î–æ—Ö—ñ–¥:</span>
                        <span id="deposit-interest" class="font-bold text-green-600">0.00 –≥—Ä–Ω</span>
                    </div>
                    <div class="flex justify-between text-lg font-bold border-t border-yellow-200 mt-2 pt-2">
                        <span class="text-gray-800">–ó–∞–≥–∞–ª—å–Ω–∞ –°—É–º–∞:</span>
                        <span id="deposit-total" class="text-gray-900">0.00 –≥—Ä–Ω</span>
                    </div>
                </div>

                <p id="deposit-error" class="text-red-500 text-sm mb-3 hidden">–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç—É.</p>
                
                <div class="flex space-x-3">
                    <button type="button" onclick="closeModal()" class="w-1/3 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="w-2/3 py-3 bg-yellow-600 text-white font-semibold rounded-xl hover:bg-yellow-700 transition">–í—ñ–¥–∫—Ä–∏—Ç–∏ –î–µ–ø–æ–∑–∏—Ç</button>
                </div>
            </form>
        </div>

        <!-- 1.4. OTHER INFO MODAL -->
        <div id="otherinfo-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="otherinfo">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–ü—Ä–æ –®–∫–µ–±–µ–¥–µ –ë–∞–Ω–∫ —Ç–∞ –î–æ–¥–∞—Ç–æ–∫</h3>
            
            <div class="space-y-4 text-gray-700">
                <p class="text-lg font-semibold border-b pb-2 text-gray-800">–®–∫–µ–±–µ–¥–µ –ë–∞–Ω–∫ ‚Äî –í–∞—à –Ω–∞–¥—ñ–π–Ω–∏–π –ø–∞—Ä—Ç–Ω–µ—Ä —É —Å–≤—ñ—Ç—ñ —Ñ—ñ–Ω–∞–Ω—Å—ñ–≤.</p>
                <p>–¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ —î —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–º –º–∞–∫–µ—Ç–æ–º, —Å—Ç–≤–æ—Ä–µ–Ω–∏–º –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó —Å—É—á–∞—Å–Ω–æ–≥–æ –º–æ–±—ñ–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫—ñ–Ω–≥—É. –£—Å—ñ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó, –≤–∫–ª—é—á–∞—é—á–∏ –±–∞–ª–∞–Ω—Å–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó —Ç–∞ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤, —î –º–æ–∫–æ–≤–∏–º–∏ —Ç–∞ —ñ–º—ñ—Ç—É—é—Ç—å —Ä–æ–±–æ—Ç—É —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É.</p>
                
                <div class="p-3 bg-gray-100 rounded-lg">
                    <p class="font-bold">–ö–ª—é—á–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –º–∞–∫–µ—Ç—É:</p>
                    <ul class="list-disc list-inside text-sm mt-1 space-y-1">
                        <li>**–ö—Ä–µ–¥–∏—Ç–Ω–∞ –ª–æ–≥—ñ–∫–∞:** –î–∏–Ω–∞–º—ñ—á–Ω—ñ –≤—ñ–¥—Å–æ—Ç–∫–∏ 1% –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É.</li>
                        <li>**–î–µ–ø–æ–∑–∏—Ç–∏:** –ú–æ–∫–æ–≤–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–æ—Ö–æ–¥—É.</li>
                        <li>**UX:** –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–π —Å–≤–∞–π–ø –∫–∞—Ä—Ç–æ–∫ –±–µ–∑ –∑–º—ñ—â–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω–∞.</li>
                        <li>**–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è:** –í—Ö—ñ–¥/—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ—Ñ—ñ–ª—é.</li>
                    </ul>
                </div>

                <p class="text-sm italic pt-2">–í–µ—Ä—Å—ñ—è –º–∞–∫–µ—Ç—É: 1.2.3. –î—è–∫—É—î–º–æ, —â–æ –æ–±—Ä–∞–ª–∏ –®–∫–µ–±–µ–¥–µ –ë–∞–Ω–∫!</p>
            </div>

            <button onclick="closeModal()" class="w-full mt-8 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
        
        <!-- 1.1. CHAT MODAL (unchanged) -->
        <div id="chat-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden flex flex-col h-5/6" role="dialog" aria-modal="true" data-modal="chat">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 flex-shrink-0">–ß–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ üí¨</h3>
            <div class="text-center text-sm text-gray-500 mb-4 flex-shrink-0">
                –û–Ω–ª–∞–π–Ω-–º–µ–Ω–µ–¥–∂–µ—Ä: <span class="text-green-500 font-semibold">–û–ª–µ–∫—Å–∞–Ω–¥—Ä</span>
            </div>

            <!-- Chat History Area -->
            <div id="chat-history" class="chat-container space-y-4 mb-4 flex-grow overflow-y-auto p-2">
                 <div class="flex justify-start">
                    <div class="message-bubble manager-message">–í—ñ—Ç–∞—î–º–æ! –Ø –≤–∞—à –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä. –ß–∏–º –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ —Å—å–æ–≥–æ–¥–Ω—ñ?</div>
                </div>
            </div>

            <!-- Input Form -->
            <form id="chat-form" onsubmit="handleChatSubmit(event)" class="flex gap-2 flex-shrink-0 pt-4 border-t border-gray-100">
                <input type="text" id="chat-input" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –≤–∞—à–µ –ø–∏—Ç–∞–Ω–Ω—è..." required class="flex-grow p-3 border border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 text-gray-800 bg-gray-50">
                <button type="submit" class="p-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition action-button">
                    <svg class="icon w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
            </form>

            <button onclick="closeModal()" class="w-full mt-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition flex-shrink-0">
                –ó–∞–∫—Ä–∏—Ç–∏
            </button>
        </div>
        
        <!-- 1.2. FULL HISTORY MODAL (unchanged) -->
        <div id="history-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden flex flex-col h-5/6" role="dialog" aria-modal="true" data-modal="history">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 flex-shrink-0">–ü–æ–≤–Ω–∞ –Ü—Å—Ç–æ—Ä—ñ—è –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</h3>
            
            <div id="full-transactions-list" class="flex-grow overflow-y-auto space-y-3 p-2 border border-gray-100 rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600">
                <!-- All transactions will be rendered here -->
            </div>

            <button onclick="closeModal()" class="w-full mt-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition flex-shrink-0">
                –ó–∞–∫—Ä–∏—Ç–∏
            </button>
        </div>


        <!-- 0.9. AUTH MODAL (Login/Signup switch) (retained) -->
        <div id="auth-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="auth">
            <h3 class="text-2xl font-bold mb-6 text-gray-800" id="auth-title">–í—Ö—ñ–¥ –≤ –∞–∫–∞—É–Ω—Ç</h3>
            
            <!-- Login Form -->
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label for="login-nick" class="block text-sm font-medium text-gray-700 mb-1">–ù—ñ–∫–Ω–µ–π–º</label>
                    <input type="text" id="login-nick" name="nick" required placeholder="–í–∞—à –Ω—ñ–∫–Ω–µ–π–º" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="mb-6">
                    <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="login-password" name="password" required placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                </div>
                <p id="login-error" class="text-red-500 text-sm mb-3 hidden">–ù–µ–≤—ñ—Ä–Ω–∏–π –Ω—ñ–∫–Ω–µ–π–º –∞–±–æ –ø–∞—Ä–æ–ª—å.</p>
                <button type="submit" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition mb-4">–£–≤—ñ–π—Ç–∏</button>
            </form>
            
            <!-- Signup Form (Initially Hidden) -->
            <form id="signup-form" onsubmit="handleSignup(event)" class="hidden">
                 <div class="mb-4">
                    <label for="signup-nick" class="block text-sm font-medium text-gray-700 mb-1">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ù—ñ–∫–Ω–µ–π–º</label>
                    <input type="text" id="signup-nick" name="nick" required placeholder="–°—Ç–≤–æ—Ä—ñ—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –Ω—ñ–∫" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                </div>
                <div class="mb-6">
                    <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="signup-password" name="password" required placeholder="–ú—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                </div>
                <p id="signup-error" class="text-red-500 text-sm mb-3 hidden">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ —Ü–∏–º –Ω—ñ–∫–Ω–µ–π–º–æ–º –≤–∂–µ —ñ—Å–Ω—É—î.</p>
                <button type="submit" class="w-full py-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition mb-4">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
            </form>
            
            <!-- Switch Button -->
            <button id="auth-switch-btn" onclick="toggleAuthMode()" class="w-full text-blue-600 text-sm hover:underline">
                –ù–µ –º–∞—î—Ç–µ –∞–∫–∞—É–Ω—Ç—É? **–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è**
            </button>
            <button onclick="closeModal()" class="w-full mt-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
        
        <!-- 1.0. PROFILE SETTINGS MODAL (retained) -->
        <div id="settings-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="settings">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é</h3>
            
            <p class="mb-6 text-lg font-semibold text-gray-700">–í–∏ —É–≤—ñ–π—à–ª–∏ —è–∫: <span id="current-user-nick" class="text-blue-600"></span></p>

            <form onsubmit="handleSettingsChange(event)" class="space-y-4">
                <div class="p-4 bg-gray-50 rounded-lg">
                    <label for="settings-nick" class="block text-sm font-medium text-gray-700 mb-1">–ó–º—ñ–Ω–∏—Ç–∏ –ù—ñ–∫–Ω–µ–π–º</label>
                    <input type="text" id="settings-nick" name="nick" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <button type="submit" class="w-full mt-3 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition text-sm">–ó–±–µ—Ä–µ–≥—Ç–∏ –ù—ñ–∫–Ω–µ–π–º</button>
                </div>
            </form>

            <div class="space-y-4 mt-6">
                <!-- –¢–µ–º–∞ (–ú–æ–∫–æ–≤–∏–π –ø–µ—Ä–µ–º–∏–∫–∞—á) -->
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <span class="font-medium text-gray-700">–¢–µ–º–Ω–∞ —Ç–µ–º–∞</span>
                    <button onclick="toggleTheme()" id="theme-toggle" class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-full hover:bg-gray-400 transition">–£–≤—ñ–º–∫–Ω—É—Ç–∏</button>
                </div>

                 <!-- –ú–æ–≤–∞ (–ú–æ–∫–æ–≤–∏–π –ø–µ—Ä–µ–º–∏–∫–∞—á) -->
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <span class="font-medium text-gray-700">–ú–æ–≤–∞ (UA/EN)</span>
                    <button onclick="handleNotification('–ó–º—ñ–Ω–∞ –º–æ–≤–∏ (Mock) –Ω–∞ EN')" class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-full hover:bg-gray-400 transition">–ó–º—ñ–Ω–∏—Ç–∏</button>
                </div>
            </div>

            <button onclick="handleLogout()" class="w-full mt-8 py-3 bg-red-600 text-white font-semibold rounded-xl hover:bg-red-700 transition">
                –í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É
            </button>
            <button onclick="closeModal()" class="w-full mt-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>


        <!-- 0. TRANSACTION DETAIL MODAL (retained) -->
        <div id="detail-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="detail">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–î–µ—Ç–∞–ª—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</h3>
            <div class="space-y-4">
                <div class="flex justify-between">
                    <span class="text-gray-500 font-medium">–û–ø–∏—Å:</span>
                    <span id="detail-name" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between border-t border-gray-100 pt-3">
                    <span class="text-gray-500 font-medium">–°—É–º–∞:</span>
                    <span id="detail-amount" class="font-bold text-lg"></span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500 font-medium">–î–∞—Ç–∞:</span>
                    <span id="detail-date" class="text-gray-700"></span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500 font-medium">–ú–æ–∫–æ–≤–∏–π ID:</span>
                    <span id="detail-id" class="text-gray-700 text-sm"></span>
                </div>
            </div>
            <button onclick="closeModal()" class="w-full mt-8 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
        
        <!-- 0.5. CARD SETTINGS MODAL (retained) -->
        <div id="cardsettings-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="cardsettings">
            <h3 class="text-2xl font-bold mb-6 text-gray-800" id="settings-card-name">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏</h3>
            
            <div id="card-delete-info" class="mb-4 hidden p-3 bg-red-50 rounded-lg text-red-700 text-sm font-medium">
                –ù–µ –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏: –ø–æ–≥–∞—Å—ñ—Ç—å –±–æ—Ä–≥ –Ω–∞ <span id="card-delete-debt"></span> –≥—Ä–Ω.
            </div>

            <form onsubmit="handleCardSettingsSubmit(event)">
                <input type="hidden" id="settings-card-id" name="id">
                <div class="mb-4">
                    <label for="settings-name" class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞ –∫–∞—Ä—Ç–∫–∏</label>
                    <input type="text" id="settings-name" name="name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">–ö–æ–ª—ñ—Ä –∫–∞—Ä—Ç–∫–∏</label>
                    <div class="flex space-x-3" id="color-options">
                        <button type="button" class="w-10 h-10 rounded-full bg-card-blue border-4 border-transparent hover:border-gray-400 focus:border-white transition" data-color="bg-card-blue" onclick="selectCardColor(this)"></button>
                        <button type="button" class="w-10 h-10 rounded-full bg-card-green border-4 border-transparent hover:border-gray-400 focus:border-white transition" data-color="bg-card-green" onclick="selectCardColor(this)"></button>
                        <button type="button" class="w-10 h-10 rounded-full bg-card-red border-4 border-transparent hover:border-gray-400 focus:border-white transition" data-color="bg-card-red" onclick="selectCardColor(this)"></button>
                        <button type="button" class="w-10 h-10 rounded-full bg-card-purple border-4 border-transparent hover:border-gray-400 focus:border-white transition" data-color="bg-card-purple" onclick="selectCardColor(this)"></button>
                        <input type="hidden" id="settings-color" name="color" required>
                    </div>
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="closeModal()" class="w-1/3 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="w-2/3 py-3 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </form>
            
            <button id="delete-card-button" onclick="handleCardDelete()" class="w-full mt-6 py-3 bg-red-600 text-white font-semibold rounded-xl hover:bg-red-700 transition disabled:bg-red-300" disabled>
                –í–∏–¥–∞–ª–∏—Ç–∏ –ö–∞—Ä—Ç–∫—É
            </button>
        </div>

        <!-- 0.7. CARDS OVERVIEW MODAL (retained) -->
        <div id="cards-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="cards">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–ú–æ—ó –ö–∞—Ä—Ç–∫–∏</h3>
            <div id="all-cards-list" class="space-y-4 mb-6">
                <!-- All cards list generated here -->
            </div>
            <button onclick="openModal('newcard')" class="w-full py-3 bg-green-500 text-white font-semibold rounded-xl hover:bg-green-600 transition action-button">
                + –í—ñ–¥–∫—Ä–∏—Ç–∏ –Ω–æ–≤—É –∫–∞—Ä—Ç—É
            </button>
            <button onclick="closeModal()" class="w-full mt-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">
                –ó–∞–∫—Ä–∏—Ç–∏
            </button>
        </div>

        <!-- 0.8. NEW CARD MODAL (retained) -->
        <div id="newcard-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="newcard">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–í—ñ–¥–∫—Ä–∏—Ç–∏ –Ω–æ–≤—É –∫–∞—Ä—Ç—É</h3>
            <form onsubmit="handleNewCardSubmit(event)">
                <div class="mb-4">
                    <label for="newcard-name" class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞ –Ω–æ–≤–æ—ó –∫–∞—Ä—Ç–∫–∏</label>
                    <input type="text" id="newcard-name" name="name" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –î–ª—è –ø–æ–¥–æ—Ä–æ–∂–µ–π" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                </div>
                <div class="mb-6">
                     <label class="block text-sm font-medium text-gray-700 mb-2">–û–±–µ—Ä—ñ—Ç—å –∫–æ–ª—ñ—Ä</label>
                    <div class="flex space-x-3" id="newcard-color-options">
                        <button type="button" class="w-10 h-10 rounded-full bg-card-blue border-4 border-transparent hover:border-gray-400 focus:border-white transition" data-color="bg-card-blue" onclick="selectNewCardColor(this)"></button>
                        <button type="button" class="w-10 h-10 rounded-full bg-card-green border-4 border-transparent hover:border-gray-400 focus:border-white transition" data-color="bg-card-green" onclick="selectNewCardColor(this)"></button>
                        <button type="button" class="w-10 h-10 rounded-full bg-card-red border-4 border-transparent hover:border-gray-400 focus:border-white transition" data-color="bg-card-red" onclick="selectNewCardColor(this)"></button>
                        <button type="button" class="w-10 h-10 rounded-full bg-card-purple border-4 border-transparent hover:border-gray-400 focus:border-white transition" data-color="bg-card-purple" onclick="selectNewCardColor(this)"></button>
                        <input type="hidden" id="newcard-color" name="color" value="bg-card-blue" required>
                    </div>
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="openModal('cards')" class="w-1/3 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–ù–∞–∑–∞–¥</button>
                    <button type="submit" class="w-2/3 py-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                </div>
            </form>
        </div>


        <!-- Other Modals (Transfer, Payment, Replenish, Credit) (retained) -->
        <div id="transfer-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="transfer">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–ü–µ—Ä–µ–∫–∞–∑ –∫–æ—à—Ç—ñ–≤</h3>
            <form id="transfer-form" onsubmit="handleTransferSubmit(event)">
                <div class="mb-4">
                    <label for="transfer-amount" class="block text-sm font-medium text-gray-700 mb-1">–°—É–º–∞ –ø–µ—Ä–µ–∫–∞–∑—É (–≥—Ä–Ω)</label>
                    <input type="number" step="0.01" min="1" id="transfer-amount" name="amount" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 500.00" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="mb-6">
                    <label for="transfer-recipient" class="block text-sm font-medium text-gray-700 mb-1">–û—Ç—Ä–∏–º—É–≤–∞—á (–Ω–∞–∑–≤–∞)</label>
                    <input type="text" id="transfer-recipient" name="recipient" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –î—Ä—É–≥—É –ü–µ—Ç—Ä—É" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                </div>
                <p id="transfer-error" class="text-red-500 text-sm mb-3 hidden">–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É.</p>
                <div class="flex space-x-3">
                    <button type="button" onclick="closeModal()" class="w-1/3 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="w-2/3 py-3 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ü–µ—Ä–µ–∫–∞–∑</button>
                </div>
            </form>
        </div>

        <div id="payment-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="payment">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–û–ø–ª–∞—Ç–∞ –ø–æ—Å–ª—É–≥</h3>
            <form id="payment-form" onsubmit="handlePaymentSubmit(event)">
                <div class="mb-4">
                    <label for="payment-service" class="block text-sm font-medium text-gray-700 mb-1">–û–±–µ—Ä—ñ—Ç—å –ø–æ—Å–ª—É–≥—É</label>
                    <select id="payment-service" name="service" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white">
                        <option value="">-- –û–±–µ—Ä—ñ—Ç—å --</option>
                        <option value="–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç (–ü—Ä–æ–≤–∞–π–¥–µ—Ä)">–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç (–ü—Ä–æ–≤–∞–π–¥–µ—Ä)</option>
                        <option value="–ú–æ–±—ñ–ª—å–Ω–∏–π –∑–≤'—è–∑–æ–∫">–ú–æ–±—ñ–ª—å–Ω–∏–π –∑–≤'—è–∑–æ–∫</option>
                        <option value="–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ –ø–æ—Å–ª—É–≥–∏">–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ –ø–æ—Å–ª—É–≥–∏</option>
                        <option value="–ë–ª–∞–≥–æ–¥—ñ–π–Ω—ñ—Å—Ç—å (–ó–°–£)">–ë–ª–∞–≥–æ–¥—ñ–π–Ω—ñ—Å—Ç—å (–ó–°–£)</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label for="payment-amount" class="block text-sm font-medium text-gray-700 mb-1">–°—É–º–∞ –æ–ø–ª–∞—Ç–∏ (–≥—Ä–Ω)</label>
                    <input type="number" step="0.01" min="1" id="payment-amount" name="amount" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 250.00" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                </div>
                <p id="payment-error" class="text-red-500 text-sm mb-3 hidden">–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É.</p>
                <div class="flex space-x-3">
                    <button type="button" onclick="closeModal()" class="w-1/3 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="w-2/3 py-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition">–û–ø–ª–∞—Ç–∏—Ç–∏</button>
                </div>
            </form>
        </div>

        <div id="replenish-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="replenish">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—É</h3>
            <form id="replenish-form" onsubmit="handleReplenishSubmit(event)">
                <div class="mb-4">
                    <label for="replenish-source" class="block text-sm font-medium text-gray-700 mb-1">–î–∂–µ—Ä–µ–ª–æ –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</label>
                    <select id="replenish-source" name="source" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 bg-white">
                        <option value="–ó —ñ–Ω—à–æ—ó –∫–∞—Ä—Ç–∫–∏">–ó —ñ–Ω—à–æ—ó –∫–∞—Ä—Ç–∫–∏</option>
                        <option value="–ì–æ—Ç—ñ–≤–∫–∞ (—Ç–µ—Ä–º—ñ–Ω–∞–ª)">–ì–æ—Ç—ñ–≤–∫–∞ (—Ç–µ—Ä–º—ñ–Ω–∞–ª)</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="replenish-sender" class="block text-sm font-medium text-gray-700 mb-1">–í—ñ–¥ –∫–æ–≥–æ (–û–ø–∏—Å)</label>
                    <input type="text" id="replenish-sender" name="sender" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ó–∞—Ä–ø–ª–∞—Ç–∞" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                </div>
                <div class="mb-6">
                    <label for="replenish-amount" class="block text-sm font-medium text-gray-700 mb-1">–°—É–º–∞ –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è (–≥—Ä–Ω)</label>
                    <input type="number" step="0.01" min="1" id="replenish-amount" name="amount" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 1000.00" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="closeModal()" class="w-1/3 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="w-2/3 py-3 bg-red-600 text-white font-semibold rounded-xl hover:bg-red-700 transition">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏</button>
                </div>
            </form>
        </div>

        <!-- Credit Modal (Dynamic content) -->
        <div id="credit-modal" class="bg-white w-full max-w-xl p-6 rounded-t-3xl shadow-2xl transform translate-y-full modal-content-transition hidden" role="dialog" aria-modal="true" data-modal="credit">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">–ö—Ä–µ–¥–∏—Ç–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏</h3>

            <!-- Dynamic Credit Info -->
            <div id="credit-info" class="mb-6 space-y-2 p-4 rounded-lg bg-indigo-50 border border-indigo-200">
                <!-- Content injected here by updateCreditModalInfo() -->
            </div>
            
            <h4 class="text-xl font-semibold text-gray-800 mb-4">–ü–æ–¥–∞—Ç–∏ –ó–∞—è–≤–∫—É</h4>
            <form id="credit-form" onsubmit="handleCreditSubmit(event)">
                <div class="mb-4">
                    <label for="credit-amount" class="block text-sm font-medium text-gray-700 mb-1">–ë–∞–∂–∞–Ω–∞ —Å—É–º–∞ –∫—Ä–µ–¥–∏—Ç—É (–≥—Ä–Ω)</label>
                    <input type="number" step="1000" min="5000" max="50000" id="credit-amount" name="amount" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 15000" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="mb-6">
                    <label for="credit-term" class="block text-sm font-medium text-gray-700 mb-1">–¢–µ—Ä–º—ñ–Ω (–º—ñ—Å—è—Ü—ñ–≤)</label>
                    <select id="credit-term" name="term" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                        <option value="6">6 –º—ñ—Å—è—Ü—ñ–≤</option>
                        <option value="12">12 –º—ñ—Å—è—Ü—ñ–≤</option>
                        <option value="24">24 –º—ñ—Å—è—Ü—ñ</option>
                    </select>
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="closeModal()" class="w-1/3 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" id="submit-credit-btn" class="w-2/3 py-3 bg-indigo-600 text-white font-semibold rounded-xl hover:bg-indigo-700 transition">–ü–æ–¥–∞—Ç–∏ –∑–∞—è–≤–∫—É</button>
                </div>
            </form>
        </div>

    </div>

    <!-- Mock Notification Panel -->
    <div id="mock-notification" class="notification fixed bottom-20 left-1/2 transform -translate-x-1/2 p-3 bg-gray-800 text-white text-center rounded-lg shadow-2xl opacity-0 pointer-events-none z-50">
        <!-- Notification text here -->
    </div>

    <!-- Fixed Bottom Navigation (Mobile Friendly) -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-xl z-40">
        <div class="flex justify-around items-center h-16 max-w-xl mx-auto">
            <!-- –ì–æ–ª–æ–≤–Ω–∞ -->
            <button onclick="handleNotification('–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É')" class="flex flex-col items-center text-blue-600">
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                <span class="text-xs mt-1">–ì–æ–ª–æ–≤–Ω–∞</span>
            </button>
            
            <!-- –ö–∞—Ä—Ç–∫–∏ (Opens Card Overview Modal) -->
            <button onclick="openCardsPage()" class="flex flex-col items-center text-gray-500 hover:text-blue-600 transition">
                <svg class="icon" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                <span class="text-xs mt-1">–ö–∞—Ä—Ç–∫–∏</span>
            </button>
            
            <!-- –Ü—Å—Ç–æ—Ä—ñ—è -->
            <button onclick="openHistoryPage()" class="flex flex-col items-center text-gray-500 hover:text-blue-600 transition">
                <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><polyline points="13 2 13 9 20 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline><line x1="8" y1="13" x2="16" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line><line x1="8" y1="17" x2="16" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line></svg>
                <span class="text-xs mt-1">–Ü—Å—Ç–æ—Ä—ñ—è</span>
            </button>
            
            <!-- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ (Chat) -->
            <button onclick="openChatPage()" class="flex flex-col items-center text-gray-500 hover:text-blue-600 transition">
                <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <span class="text-xs mt-1">–ß–∞—Ç</span>
            </button>
        </div>
    </nav>

    <script>
        // --- AUTH STATE & DATA ---
        let cards = [
            // UPDATED: –ù–æ–≤—ñ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –±–∞–ª–∞–Ω—Å–∏
            { id: 1, name: '–û—Å–Ω–æ–≤–Ω–∞', balance: 5436.00, number: '1234', color: 'bg-card-blue', icon: 'üí≥' },
            { id: 2, name: '–î–ª—è –ø–æ–∫—É–ø–æ–∫', balance: 1542.00, number: '5678', color: 'bg-card-green', icon: 'üõí' },
            { id: 3, name: '–ö—Ä–µ–¥–∏—Ç–Ω–∞', balance: 0.00, number: '9012', color: 'bg-card-red', icon: 'üí∞', 
              creditLimit: 50000.00, debt: 0.00, initialLoan: 0.00 
            },
        ];
        
        let activeCardIndex = 0; 
        let isBalanceVisible = true;
        let transactionIdCounter = 9;
        let newCardIdCounter = 4;
        let interestIntervalId = null;
        let notificationTimeout = null; // –î–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è–º–∏

        // Mock Auth/Profile State
        let currentUser = null; 
        let mockUsers = JSON.parse(localStorage.getItem('skibidiUsers')) || [];
        let isDarkTheme = localStorage.getItem('skibidiTheme') === 'dark';

        // –ú–æ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
        const transactions = [
            { id: 1, name: '–°—ñ–ª—å–ø–æ', amount: -450.50, date: '–°—å–æ–≥–æ–¥–Ω—ñ', icon: 'üõí', transactionId: 'TX12345678', cardName: '–û—Å–Ω–æ–≤–Ω–∞' },
            { id: 2, name: '–ü–µ—Ä–µ–∫–∞–∑ –≤—ñ–¥ –û–ª–µ–Ω–∏ –ö.', amount: 1500.00, date: '–°—å–æ–≥–æ–¥–Ω—ñ', icon: 'üí∞', transactionId: 'TX12345679', cardName: '–û—Å–Ω–æ–≤–Ω–∞' },
            { id: 3, name: 'Netflix (–ü—ñ–¥–ø–∏—Å–∫–∞)', amount: -399.00, date: '–í—á–æ—Ä–∞', icon: 'üé¨', transactionId: 'TX12345680', cardName: '–î–ª—è –ø–æ–∫—É–ø–æ–∫' },
            { id: 4, name: 'Uklon (–¢–∞–∫—Å—ñ)', amount: -125.80, date: '11 –ñ–æ–≤—Ç–Ω—è', icon: 'üöï', transactionId: 'TX12345681', cardName: '–û—Å–Ω–æ–≤–Ω–∞' },
            { id: 5, name: '–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤', amount: 800.00, date: '10 –ñ–æ–≤—Ç–Ω—è', icon: '‚Ü©Ô∏è', transactionId: 'TX12345682', cardName: '–î–ª—è –ø–æ–∫—É–ø–æ–∫' },
            { id: 6, name: 'Comfy (–¢–µ—Ö–Ω—ñ–∫–∞)', amount: -5899.00, date: '09 –ñ–æ–≤—Ç–Ω—è', icon: 'üñ•Ô∏è', transactionId: 'TX12345683', cardName: '–û—Å–Ω–æ–≤–Ω–∞' },
            { id: 7, name: 'Kyivstar (–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è)', amount: -150.00, date: '08 –ñ–æ–≤—Ç–Ω—è', icon: 'üì±', transactionId: 'TX12345684', cardName: '–û—Å–Ω–æ–≤–Ω–∞' },
            { id: 8, name: '–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –≤—ñ–¥ –ó–∞—Ä–ø–ª–∞—Ç–∏', amount: 35000.00, date: '05 –ñ–æ–≤—Ç–Ω—è', icon: 'üíµ', transactionId: 'TX12345685', cardName: '–û—Å–Ω–æ–≤–Ω–∞' },
        ];
        
        // Mock Chat History
        let chatHistory = [
            { sender: 'manager', text: '–í—ñ—Ç–∞—î–º–æ! –Ø –≤–∞—à –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä. –ß–∏–º –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ —Å—å–æ–≥–æ–¥–Ω—ñ?' }
        ];
        
        // =========================================================================
        // --- CORE AUXILIARY FUNCTIONS (MOVED TO TOP FOR DEFINITION) ---
        // =========================================================================

        function formatCurrency(amount) {
             return parseFloat(amount).toLocaleString('uk-UA', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            });
        }
        
        function getAnnualRate(term) {
            if (term <= 6) return 0.10; // 10%
            if (term <= 12) return 0.11; // 11%
            return 0.12; // 12%
        }

        function calculateDeposit() {
            const amountInput = document.getElementById('deposit-amount');
            const termInput = document.getElementById('deposit-term');
            const interestSpan = document.getElementById('deposit-interest');
            const totalSpan = document.getElementById('deposit-total');

            const amount = parseFloat(amountInput?.value) || 0;
            const term = parseInt(termInput?.value) || 0;

            if (amount < 1000 || term === 0) {
                 if (interestSpan) interestSpan.textContent = '0.00 –≥—Ä–Ω';
                 if (totalSpan) totalSpan.textContent = '0.00 –≥—Ä–Ω';
                 return;
            }

            const annualRate = getAnnualRate(term);
            const interest = amount * annualRate * (term / 12); 
            const total = amount + interest;

            if (interestSpan) interestSpan.textContent = formatCurrency(interest.toFixed(2)) + ' –≥—Ä–Ω';
            if (totalSpan) totalSpan.textContent = formatCurrency(total.toFixed(2)) + ' –≥—Ä–Ω';
        }
        
        function showTransactionDetails(txId) {
            const tx = transactions.find(t => t.id === txId);
            if (!tx) return;

            document.getElementById('detail-name').textContent = tx.name;
            document.getElementById('detail-date').textContent = tx.date;
            document.getElementById('detail-id').textContent = tx.transactionId;
            
            const isDebit = tx.amount < 0;
            const sign = isDebit ? '' : '+';
            const formattedAmount = `${sign}${Math.abs(tx.amount).toLocaleString('uk-UA', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            })}`;

            const amountEl = document.getElementById('detail-amount');
            amountEl.textContent = `${formattedAmount} –≥—Ä–Ω`;
            amountEl.className = `font-bold text-lg ${isDebit ? 'text-red-600' : 'text-green-600'}`;

            openModal('detail');
        }

        function openModal(modalId) {
            const modalContainer = document.getElementById('modal-container');
            const modalContent = document.getElementById(`${modalId}-modal`);
            
            if (modalId === 'cards') renderAllCards();
            if (modalId === 'history') renderFullTransactions();
            if (modalId === 'chat') renderChatHistory(); 
            if (modalId === 'deposit') {
                 // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–º'—è –∫–∞—Ä—Ç–∫–∏ —É –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ –¥–µ–ø–æ–∑–∏—Ç—É
                const activeCard = cards[activeCardIndex];
                const cardNameSpan = document.querySelector('#deposit-modal .text-blue-600');
                if (cardNameSpan) cardNameSpan.textContent = activeCard ? activeCard.name : '–ù/–î';
                calculateDeposit();
            }

            modalContainer.classList.remove('opacity-0', 'pointer-events-none');
            modalContent.classList.remove('hidden', 'translate-y-full');
            
            // –•–æ–≤–∞—î–º–æ –≤—Å—ñ —ñ–Ω—à—ñ –º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ –ø–µ—Ä–µ–¥ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è–º –Ω–æ–≤–æ–≥–æ (UX)
            document.querySelectorAll('.modal-content-transition').forEach(el => {
                if (el.id !== `${modalId}-modal`) {
                     el.classList.add('hidden');
                }
            });
        }

        function closeModal() {
            const modalContainer = document.getElementById('modal-container');
            const openModals = document.querySelectorAll('.modal-content-transition:not(.hidden)');
            
            openModals.forEach(modal => {
                modal.classList.add('translate-y-full');
                setTimeout(() => modal.classList.add('hidden'), 300); 
            });

            modalContainer.classList.add('opacity-0', 'pointer-events-none');
        }

        function handleNotification(message, duration = 2000) {
            const notifElement = document.getElementById('mock-notification');
            
            if (notificationTimeout) {
                clearTimeout(notificationTimeout);
                notifElement.style.opacity = '0';
                notifElement.style.transform = 'translate(-50%, 10px)';
            }

            notifElement.textContent = `‚úÖ ${message}`;
            
            setTimeout(() => {
                notifElement.style.opacity = '1';
                notifElement.style.transform = 'translate(-50%, 0)';
            }, 50);

            notificationTimeout = setTimeout(() => {
                notifElement.style.opacity = '0';
                notifElement.style.transform = 'translate(-50%, 10px)';
            }, duration);
        }
        
        function handleDepositSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const amountInput = parseFloat(form.elements['amount'].value);
            const term = parseInt(form.elements['term'].value);
            const errorElement = document.getElementById('deposit-error');

            const activeCard = cards[activeCardIndex];

            if (isNaN(amountInput) || amountInput < 1000) {
                 handleNotification('–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Å—É–º—É (–º—ñ–Ω. 1000 –≥—Ä–Ω).');
                 return;
            }

            if (amountInput > activeCard.balance) {
                errorElement.classList.remove('hidden');
                return;
            }
            errorElement.classList.add('hidden');

            const annualRate = getAnnualRate(term);
            const interest = amountInput * annualRate * (term / 12); 
            const total = amountInput + interest;

            addTransaction(-amountInput, `–í—ñ–¥–∫—Ä–∏—Ç—Ç—è –¥–µ–ø–æ–∑–∏—Ç—É (${term} –º—ñ—Å.)`, 'üõ°Ô∏è'); 
            
            handleNotification(`–î–µ–ø–æ–∑–∏—Ç –Ω–∞ ${formatCurrency(amountInput)} –≥—Ä–Ω –≤—ñ–¥–∫—Ä–∏—Ç–æ! –û—á—ñ–∫—É–≤–∞–Ω–∏–π –¥–æ—Ö—ñ–¥: ${formatCurrency(interest)} –≥—Ä–Ω.`, 5000);
            
            // –ú–æ–∫–æ–≤–∞ —ñ–º—ñ—Ç–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–µ–ø–æ–∑–∏—Ç—É
            setTimeout(() => {
                const updatedCard = cards[activeCardIndex];
                // –ó–∞—Ä–∞—Ö–æ–≤—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É —Å—É–º—É –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (–¥–ª—è –º–æ–∫-—Å–∏–º—É–ª—è—Ü—ñ—ó)
                updatedCard.balance = parseFloat((updatedCard.balance + total).toFixed(2));
                saveCardData();
                updateCardDisplay();
                
                transactions.unshift({ 
                    id: transactionIdCounter++, 
                    name: `–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–µ–ø–æ–∑–∏—Ç—É (+${term} –º—ñ—Å.)`, 
                    amount: total, 
                    date: '–î–µ–ø–æ–∑–∏—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 
                    icon: '‚úÖ', 
                    transactionId: `DEP${Date.now()}`, 
                    cardName: updatedCard.name 
                });
                renderTransactions();
                handleNotification(`–î–µ–ø–æ–∑–∏—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ó–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ ${formatCurrency(total)} –≥—Ä–Ω.`, 6000);
            }, 60000); // –°–ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥ (1 —Ö–≤–∏–ª–∏–Ω—É) –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó

            closeModal();
        }

        // =========================================================================
        // --- INITIALIZATION AND DOM READY ---
        // =========================================================================
        
        document.addEventListener('DOMContentLoaded', () => {
            loadAuthState();
            loadCardData(); 
            updateCardDisplay();
            renderTransactions();
            setupSwipeListener();
            applyTheme();
            renderHeaderButton();
            startInterestTimer(); 
        });


        // --- PERSISTENCE & INTEREST LOGIC ---

        function loadCardData() {
            const storedCards = localStorage.getItem('skibidiCards');
            if (storedCards) {
                try { 
                    const persistedCards = JSON.parse(storedCards);
                    
                    cards.forEach((card, index) => {
                        const persistedCard = persistedCards.find(c => c.id === card.id);
                        if (persistedCard) {
                            // –û–Ω–æ–≤–ª—é—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –ø–æ–ª—è
                            cards[index] = { ...card, ...persistedCard };
                        }
                    });
                    
                    // –î–æ–¥–∞—î–º–æ –Ω–æ–≤—ñ –∫–∞—Ä—Ç–∫–∏, —è–∫—ñ –±—É–ª–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ
                    persistedCards.filter(pc => !cards.some(c => c.id === pc.id)).forEach(pc => cards.push(pc));
                } catch(e) {
                    console.error("Error loading cards from local storage, resetting state.", e);
                    // –Ø–∫—â–æ –¥–∞–Ω—ñ –ø–æ—à–∫–æ–¥–∂–µ–Ω—ñ, —Å–∫–∏–¥–∞—î–º–æ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É —ñ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ.
                    saveCardData(); 
                }
            }
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∞–∫—Ç–∏–≤–Ω–∏–π —ñ–Ω–¥–µ–∫—Å –≤—Å–µ —â–µ –∫–æ—Ä–µ–∫—Ç–Ω–∏–π
            if (activeCardIndex >= cards.length || activeCardIndex < 0) {
                activeCardIndex = 0;
            }
        }
        
        function saveCardData() {
            localStorage.setItem('skibidiCards', JSON.stringify(cards));
        }

        function accrueInterest() {
            const creditCard = cards.find(c => c.id === 3);
            if (!creditCard || creditCard.debt <= 0) return;

            const interestRate = 0.01; 
            const interestAmount = creditCard.initialLoan * interestRate; 
            
            if (interestAmount > 0) {
                 creditCard.debt = parseFloat((creditCard.debt + interestAmount).toFixed(2));
                 saveCardData(); 

                 transactions.unshift({ 
                    id: transactionIdCounter++, 
                    name: `–ù–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤ (+${(interestRate * 100).toFixed(0)}%)`, 
                    amount: -interestAmount, 
                    date: '–ù–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ', 
                    icon: '‚è∞', 
                    transactionId: `INT${Date.now()}`, 
                    cardName: creditCard.name 
                });
                
                if (activeCardIndex === cards.findIndex(c => c.id === 3)) {
                     updateCardDisplay();
                }
                
                console.log(`[INTEREST] –ù–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ ${interestAmount.toFixed(2)} –≥—Ä–Ω. –ë–æ—Ä–≥: ${creditCard.debt.toFixed(2)}`);
            }
        }

        function startInterestTimer() {
            if (interestIntervalId) clearInterval(interestIntervalId);
            interestIntervalId = setInterval(accrueInterest, 60000); 
        }

        // --- AUTHENTICATION & PROFILE LOGIC (retained) ---
        
        function loadAuthState() {
            const storedUser = localStorage.getItem('skibidiCurrentUser');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
            }
        }

        function saveAuthState() {
            if (currentUser) {
                localStorage.setItem('skibidiCurrentUser', JSON.stringify(currentUser));
            } else {
                localStorage.removeItem('skibidiCurrentUser');
            }
            localStorage.setItem('skibidiUsers', JSON.stringify(mockUsers));
        }

        function renderHeaderButton() {
            const btn = document.getElementById('profile-button');
            if (currentUser) {
                btn.innerHTML = `<svg class="icon" viewBox="0 0 24 24"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`;
            } else {
                btn.innerHTML = `<svg class="icon" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`;
            }
        }
        
        function handleProfileClick() {
            if (currentUser) {
                openSettingsModal();
            } else {
                openModal('auth');
                document.getElementById('auth-title').textContent = '–í—Ö—ñ–¥ –≤ –∞–∫–∞—É–Ω—Ç';
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('signup-form').classList.add('hidden');
                document.getElementById('auth-switch-btn').innerHTML = '–ù–µ –º–∞—î—Ç–µ –∞–∫–∞—É–Ω—Ç—É? **–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è**';
            }
        }

        function handleLogout() {
            currentUser = null;
            saveAuthState();
            renderHeaderButton();
            handleNotification('–í–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏–π—à–ª–∏ –∑ –∞–∫–∞—É–Ω—Ç—É.', 2500);
            closeModal();
        }
        
        function openSettingsModal() {
             if (!currentUser) return; 

             document.getElementById('current-user-nick').textContent = currentUser.nick;
             document.getElementById('settings-nick').value = currentUser.nick;
             
             const themeBtn = document.getElementById('theme-toggle');
             themeBtn.textContent = isDarkTheme ? '–í–∏–º–∫–Ω—É—Ç–∏' : '–£–≤—ñ–º–∫–Ω—É—Ç–∏';
             themeBtn.classList.toggle('bg-gray-300', !isDarkTheme);
             themeBtn.classList.toggle('bg-blue-600', isDarkTheme);
             themeBtn.classList.toggle('text-white', isDarkTheme);


             openModal('settings');
        }

        function handleSettingsChange(event) {
             event.preventDefault();
             const form = event.target;
             const newNick = form.elements['nick'].value.trim();

             if (newNick === currentUser.nick) {
                 handleNotification('–ù—ñ–∫–Ω–µ–π–º –Ω–µ –∑–º—ñ–Ω–µ–Ω–æ.', 1500);
                 return;
             }
             
             const userIndex = mockUsers.findIndex(u => u.nick === currentUser.nick);
             if (userIndex !== -1) {
                 mockUsers[userIndex].nick = newNick;
             }
             
             currentUser.nick = newNick;
             
             saveAuthState();
             document.getElementById('current-user-nick').textContent = newNick;
             handleNotification(`–ù—ñ–∫–Ω–µ–π–º —É—Å–ø—ñ—à–Ω–æ –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞ ${newNick}!`, 2500);
        }

        function applyTheme() {
            document.body.classList.toggle('dark', isDarkTheme);
        }

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            localStorage.setItem('skibidiTheme', isDarkTheme ? 'dark' : 'light');
            applyTheme();
            openSettingsModal(); 
            const message = isDarkTheme ? '–£–≤—ñ–º–∫–Ω–µ–Ω–æ —Ç–µ–º–Ω—É —Ç–µ–º—É!' : '–£–≤—ñ–º–∫–Ω–µ–Ω–æ —Å–≤—ñ—Ç–ª—É —Ç–µ–º—É!';
            handleNotification(message, 2000);
        }


        // --- CORE BANKING & CARD LOGIC (retained) ---


        function updateCardDisplay() {
            const activeCard = cards[activeCardIndex];
            const cardElement = document.getElementById('active-card');
            
            // –í–∏–¥–∞–ª–µ–Ω–æ –∫–Ω–æ–ø–∫–∏ —Å—Ç—Ä—ñ–ª–æ–∫, —Ç–æ–º—É —ó—Ö –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç—É—Ç –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–µ

            if (!activeCard) {
                 cardElement.innerHTML = `<p class="text-white text-sm">–ö–∞—Ä—Ç–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ.</p>`;
                 return;
            }
            
            cardElement.className = `skibidi-card text-white p-5 rounded-xl cursor-grab active:cursor-grabbing ${activeCard.color}`;
            
            let balanceHtml;

            if (activeCard.id === 3) { // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –ö—Ä–µ–¥–∏—Ç–Ω–æ—ó –∫–∞—Ä—Ç–∫–∏
                const availableCredit = activeCard.creditLimit - activeCard.debt;
                const availableFunds = activeCard.balance; 
                const totalAvailable = availableFunds + Math.max(0, availableCredit); 
                const debt = activeCard.debt;

                balanceHtml = `
                    <div class="space-y-1">
                        <p class="text-sm opacity-75">–î–æ—Å—Ç—É–ø–Ω–∏–π –±–∞–ª–∞–Ω—Å</p>
                        <div class="flex items-center space-x-2">
                            <span id="balance-display" class="text-3xl font-bold tracking-tight">${isBalanceVisible ? formatCurrency(totalAvailable) : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'}</span>
                            <span class="text-xl font-semibold opacity-80">–≥—Ä–Ω</span>
                        </div>
                        <p class="text-xs opacity-75 ${debt > 0 ? 'text-yellow-300' : ''}">
                            ${debt > 0 ? '–ë–æ—Ä–≥: ' + formatCurrency(debt) + ' –≥—Ä–Ω' : '–ë–æ—Ä–≥—É –Ω–µ–º–∞—î!'}
                        </p>
                    </div>
                    <!-- –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ—à—Ç–∏ -->
                    <div class="text-xs opacity-80 mt-2">
                        <p>–í–ª–∞—Å–Ω—ñ –∫–æ—à—Ç–∏: ${formatCurrency(availableFunds)} –≥—Ä–Ω</p>
                        <p>–ö—Ä–µ–¥–∏—Ç–Ω–∏–π –ª—ñ–º—ñ—Ç: ${formatCurrency(activeCard.creditLimit)} –≥—Ä–Ω</p>
                    </div>
                `;
            } else { // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∑–≤–∏—á–∞–π–Ω–æ—ó –∫–∞—Ä—Ç–∫–∏
                balanceHtml = `
                    <p class="text-sm opacity-75 mb-1">${activeCard.name}</p>
                    <div class="flex items-center space-x-2">
                        <span id="balance-display" class="text-3xl font-bold tracking-tight">${isBalanceVisible ? formatCurrency(activeCard.balance) : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'}</span>
                        <span class="text-xl font-semibold opacity-80">–≥—Ä–Ω</span>
                    </div>
                `;
            }
            
            // –í—Å—Ç–∞–≤–ª—è—î–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–∫–∏
            cardElement.innerHTML = `
                <div class="flex flex-col h-full justify-between">
                    <div class="flex justify-between items-start">
                        <div class="flex-grow">
                            ${balanceHtml}
                        </div>
                        <div class="bg-yellow-400 text-gray-900 font-extrabold px-2 py-1 text-sm rounded-lg rotate-12 mt-1">
                            ${activeCard.icon}
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-xs opacity-60 mt-2">**** ${activeCard.number} (MC)</p>

                        <button onclick="openCardSettings(${activeCard.id})" class="w-full mt-2 bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-1.5 text-sm rounded-lg transition action-button">
                            –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                        </button>
                    </div>
                </div>
                <button id="toggle-balance-btn" onclick="toggleBalanceVisibility()" class="absolute top-6 right-6 text-white opacity-70 hover:opacity-100 transition p-1">
                    <!-- Eye Icon -->
                    <svg id="eye-open" class="icon ${isBalanceVisible ? '' : 'hidden'}" viewBox="0 0 24 24" stroke="currentColor"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    <!-- Eye Off Icon -->
                    <svg id="eye-closed" class="icon ${isBalanceVisible ? 'hidden' : ''}" viewBox="0 0 24 24" stroke="currentColor"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-10-7-10-7a1.8 1.8 0 0 1 .45-.48m5-10.5C19.92 5.06 22 12 22 12c-3 7-10 7-10 7"></path><path d="M4.22 4.22L2 2m18 20l-2.22-2.22m-8.98-8.98l-3.34-3.34"></path><path d="M9.31 9.31L7.1 7.1"></path></svg>
                </button>
            `;
            
            renderTransactions();
            calculateDeposit(); 
        }

        function toggleBalanceVisibility() {
            isBalanceVisible = !isBalanceVisible;
            updateCardDisplay();
            const message = isBalanceVisible ? '–ë–∞–ª–∞–Ω—Å –≤–∏–¥–Ω–æ' : '–ë–∞–ª–∞–Ω—Å –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ';
            handleNotification(message, 1500);
        }

        function nextCard() {
            if (activeCardIndex < cards.length - 1) {
                activeCardIndex++;
                updateCardDisplay();
                handleNotification(`–ê–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∫–∞: ${cards[activeCardIndex].name}`, 1000);
            }
        }

        function prevCard() {
            if (activeCardIndex > 0) {
                activeCardIndex--;
                updateCardDisplay();
                handleNotification(`–ê–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∫–∞: ${cards[activeCardIndex].name}`, 1000);
            }
        }

        // --- CARD MANAGEMENT LOGIC (retained) ---

        function openCardSettings(cardId) {
            const card = cards.find(c => c.id === cardId);
            if (!card) return;

            document.getElementById('settings-card-id').value = card.id;
            document.getElementById('settings-name').value = card.name;
            document.getElementById('settings-card-name').textContent = `–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏: ${card.name}`;

            document.getElementById('settings-color').value = card.color;
            document.querySelectorAll('#color-options button').forEach(btn => {
                btn.classList.remove('border-white', 'border-gray-400');
                if (btn.getAttribute('data-color') === card.color) {
                    btn.classList.add('border-white');
                } else {
                    btn.classList.add('border-gray-400');
                }
            });
            
            // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í–∏–¥–∞–ª–∏—Ç–∏"
            const deleteBtn = document.getElementById('delete-card-button');
            const deleteInfo = document.getElementById('card-delete-info');

            if (card.id === 3 && card.debt > 0) {
                deleteBtn.disabled = true;
                deleteInfo.classList.remove('hidden');
                document.getElementById('card-delete-debt').textContent = formatCurrency(card.debt);
            } else if (cards.length === 1) {
                deleteBtn.disabled = true;
                deleteInfo.classList.remove('hidden');
                deleteInfo.textContent = '–ù–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏ —î–¥–∏–Ω—É –∫–∞—Ä—Ç–∫—É.';
            } else {
                deleteBtn.disabled = false;
                deleteInfo.classList.add('hidden');
            }

            openModal('cardsettings');
        }

        function handleCardDelete() {
            const cardId = parseInt(document.getElementById('settings-card-id').value);
            const cardIndex = cards.findIndex(c => c.id === cardId);
            if (cardIndex === -1) return;

            const cardToDelete = cards[cardIndex];

            // –ó–∞—Ö–∏—Å—Ç
            if (cardToDelete.id === 3 && cardToDelete.debt > 0) {
                handleNotification('–ù–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ä—Ç–∫—É –∑ –∞–∫—Ç–∏–≤–Ω–∏–º –∫—Ä–µ–¥–∏—Ç–æ–º!', 3000);
                return;
            }
            if (cards.length === 1) {
                handleNotification('–ù–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏ —î–¥–∏–Ω—É –∫–∞—Ä—Ç–∫—É!', 3000);
                return;
            }

            // –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏
            cards.splice(cardIndex, 1);
            saveCardData();

            // –ö–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ñ–Ω–¥–µ–∫—Å—É
            if (activeCardIndex >= cards.length) {
                activeCardIndex = cards.length - 1;
            } else if (activeCardIndex === cardIndex) {
                 activeCardIndex = 0;
            }

            updateCardDisplay();
            handleNotification(`–ö–∞—Ä—Ç–∫—É "${cardToDelete.name}" –≤–∏–¥–∞–ª–µ–Ω–æ.`, 2500);
            closeModal();
        }

        function handleCardSettingsSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const cardId = parseInt(form.elements['id'].value);
            const newName = form.elements['name'].value.trim();
            const newColor = form.elements['color'].value;

            const cardIndex = cards.findIndex(c => c.id === cardId);
            if (cardIndex === -1) return;

            cards[cardIndex].name = newName;
            cards[cardIndex].color = newColor;

            if (cardIndex === activeCardIndex) {
                updateCardDisplay();
            }
            
            saveCardData();
            handleNotification(`–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏ "${newName}" –∑–±–µ—Ä–µ–∂–µ–Ω–æ!`, 2500);
            closeModal();
        }

        function handleNewCardSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const newName = form.elements['name'].value.trim();
            const newColor = form.elements['color'].value;

            const newCard = {
                id: newCardIdCounter++,
                name: newName,
                balance: 0.00,
                number: Math.floor(1000 + Math.random() * 9000).toString(),
                color: newColor,
                icon: '‚ú®',
            };
            
            cards.push(newCard);
            activeCardIndex = cards.length - 1; 
            
            saveCardData();
            handleNotification(`–ù–æ–≤–∞ –∫–∞—Ä—Ç–∞ "${newName}" —Å—Ç–≤–æ—Ä–µ–Ω–∞!`, 3000);
            updateCardDisplay();
            closeModal();
        }


        // --- SWIPE LOGIC (FIXED) ---
        let startX = 0;
        let startY = 0;
        let isScrolling = undefined;

        function setupSwipeListener() {
            const cardPlaceholder = document.getElementById('card-placeholder');
            // FIX: passive: false –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–ª–∏–∫–∞—Ç–∏ event.preventDefault() –¥–ª—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å–∫—Ä–æ–ª—É
            cardPlaceholder.addEventListener('touchstart', handleTouchStart, { passive: false });
            cardPlaceholder.addEventListener('touchmove', handleTouchMove, { passive: false }); 
            cardPlaceholder.addEventListener('touchend', handleTouchEnd);
        }

        function handleTouchStart(event) {
            startX = event.touches[0].clientX;
            startY = event.touches[0].clientY;
            isScrolling = undefined;
        }

        function handleTouchMove(event) {
            if (startX === 0) return; 

            const diffX = event.touches[0].clientX - startX;
            const diffY = event.touches[0].clientY - startY;

            if (typeof isScrolling === 'undefined') {
                isScrolling = Math.abs(diffX) < Math.abs(diffY);
            }

            if (isScrolling === false) {
                // –ë–ª–æ–∫—É—î–º–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏–π —Å–∫—Ä–æ–ª, —è–∫—â–æ —Ä—É—Ö –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–π
                event.preventDefault(); 
            }
        }
        
        function handleTouchEnd(event) {
            if (!startX) return;
            const endX = event.changedTouches[0].clientX;
            const diff = startX - endX;
            const swipeThreshold = 50; 

            if (Math.abs(diff) > swipeThreshold && isScrolling === false) {
                if (diff > 0) {
                    nextCard();
                } else {
                    prevCard();
                }
            }
            startX = 0; 
            startY = 0;
            isScrolling = undefined;
        }


        // --- TRANSACTION HANDLERS (Credit Logic Fixed) ---
        
        function checkBalance(amount, errorId) {
            const activeCard = cards[activeCardIndex];
            const errorElement = document.getElementById(errorId);
            
            if (activeCard.id !== 3 && amount > activeCard.balance) {
                errorElement.classList.remove('hidden');
                return false;
            }
            
            if (activeCard.id === 3) {
                const availableCredit = activeCard.creditLimit - activeCard.debt;
                const totalAvailable = activeCard.balance + Math.max(0, availableCredit);
                 if (amount > totalAvailable) {
                    errorElement.classList.remove('hidden');
                    return false;
                 }
            }

            errorElement.classList.add('hidden');
            return true;
        }

        function handleReplenishSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const amountInput = parseFloat(form.elements['amount'].value);
            const source = form.elements['source'].value;
            const sender = form.elements['sender'].value.trim() || source;

            if (isNaN(amountInput) || amountInput <= 0) {
                 handleNotification('–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Å—É–º—É.');
                 return;
            }

            const activeCard = cards[activeCardIndex];
            if (activeCard.id === 3 && activeCard.debt > 0) {
                const debtToPay = activeCard.debt;
                
                if (amountInput >= debtToPay) {
                    activeCard.debt = 0.00;
                    activeCard.initialLoan = 0.00; // <--- FIX: –°–∫–∏–¥–∞—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—É —Å—É–º—É –∫—Ä–µ–¥–∏—Ç—É
                    
                    const remainingAmount = amountInput - debtToPay;
                    addTransaction(remainingAmount, `–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –≤—ñ–¥ ${sender} (–ó–∞–ª–∏—à–æ–∫)`, '‚¨ÜÔ∏è'); 
                    handleNotification(`–ë–æ—Ä–≥ (${formatCurrency(debtToPay)} –≥—Ä–Ω) –ø–æ–≥–∞—à–µ–Ω–æ. –ó–∞–ª–∏—à–æ–∫ ${formatCurrency(remainingAmount)} –≥—Ä–Ω –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ.`, 4500);
                } else {
                    activeCard.debt = parseFloat((debtToPay - amountInput).toFixed(2));
                    handleNotification(`–ß–∞—Å—Ç–∏–Ω–∞ –±–æ—Ä–≥—É –ø–æ–≥–∞—à–µ–Ω–∞ (${formatCurrency(amountInput)} –≥—Ä–Ω). –ó–∞–ª–∏—à–æ–∫ –±–æ—Ä–≥—É: ${formatCurrency(activeCard.debt)} –≥—Ä–Ω.`, 4500);
                }
                saveCardData();
                updateCardDisplay();
            } else {
                addTransaction(amountInput, `–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –≤—ñ–¥ ${sender}`, '‚¨ÜÔ∏è'); 
                handleNotification(`–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–≤–Ω–µ–Ω–æ –Ω–∞ ${amountInput.toFixed(2)} –≥—Ä–Ω!`, 3000);
            }
            closeModal();
        }

        function addTransaction(amount, name, icon, cardId = null) {
            const activeCard = cardId ? cards.find(c => c.id === cardId) : cards[activeCardIndex];
            if (!activeCard) return;

            activeCard.balance = parseFloat((activeCard.balance + amount).toFixed(2));
            
            if (activeCard.id === 3 && amount < 0) {
                if (activeCard.debt > 0) {
                     activeCard.debt = parseFloat((activeCard.debt - amount).toFixed(2));
                } else if (activeCard.balance < 0) {
                    activeCard.debt = parseFloat((activeCard.debt - activeCard.balance).toFixed(2)); 
                }
            }


            const newTransaction = {
                id: transactionIdCounter,
                name: name,
                amount: amount,
                date: '–ó–∞—Ä–∞–∑',
                icon: icon,
                transactionId: `TX${10000000 + transactionIdCounter}`,
                cardName: activeCard.name, 
            };
            transactionIdCounter++;

            transactions.unshift(newTransaction);
            
            saveCardData();
            updateCardDisplay();
            renderTransactions();
        }

        // --- Other auxiliary functions (retained) ---

        function handleTransferSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const amountInput = parseFloat(form.elements['amount'].value);
            const recipient = form.elements['recipient'].value.trim();

            if (!checkBalance(amountInput, 'transfer-error')) return;
            
            addTransaction(-amountInput, recipient, 'üí∏'); 
            handleNotification(`–£—Å–ø—ñ—à–Ω–æ –ø–µ—Ä–µ–∫–∞–∑–∞–Ω–æ ${amountInput.toFixed(2)} –≥—Ä–Ω –¥–æ ${recipient}`, 3000);
            closeModal();
        }

        function handlePaymentSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const amountInput = parseFloat(form.elements['amount'].value);
            const service = form.elements['service'].value;

            if (!checkBalance(amountInput, 'payment-error')) return;

            addTransaction(-amountInput, service, 'üí≥'); 
            handleNotification(`–£—Å–ø—ñ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω–æ ${amountInput.toFixed(2)} –≥—Ä–Ω –∑–∞ –ø–æ—Å–ª—É–≥—É "${service}"`, 3000);
            closeModal();
        }
        
        function handleCreditSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const amount = parseFloat(form.elements['amount'].value);
            const term = form.elements['term'].value;

            const creditCard = cards.find(c => c.id === 3);

            if (amount > creditCard.creditLimit) {
                 handleNotification('–ó–∞—è–≤–ª–µ–Ω–∞ —Å—É–º–∞ –ø–µ—Ä–µ–≤–∏—â—É—î –∫—Ä–µ–¥–∏—Ç–Ω–∏–π –ª—ñ–º—ñ—Ç!', 3000);
                 return;
            }

            creditCard.balance = parseFloat((creditCard.balance + amount).toFixed(2));
            creditCard.debt = parseFloat((creditCard.debt + amount).toFixed(2));
            creditCard.initialLoan = amount; 

            addTransaction(amount, `–û—Ç—Ä–∏–º–∞–Ω–Ω—è –ö—Ä–µ–¥–∏—Ç—É (—Ç–µ—Ä–º—ñ–Ω ${term} –º—ñ—Å.)`, 'üí∞', 3); 
            
            saveCardData();

            handleNotification(`–ö—Ä–µ–¥–∏—Ç ${formatCurrency(amount)} –≥—Ä–Ω –≤–∏–¥–∞–Ω–æ –Ω–∞ –∫–∞—Ä—Ç—É "${creditCard.name}"!`, 4000);
            closeModal();
            updateCardDisplay(); 
            startInterestTimer(); 
        }

        function renderAllCards() {
            const list = document.getElementById('all-cards-list');
            list.innerHTML = '';
            
            cards.forEach((card, index) => {
                const cardHtml = `
                    <div class="flex justify-between items-center p-4 rounded-xl shadow-md ${card.color} text-white">
                        <div class="flex-grow">
                            <p class="text-lg font-bold">${card.name}</p>
                            ${card.id === 3 && card.debt > 0 ? `<p class="text-xs text-yellow-300">–ë–æ—Ä–≥: ${formatCurrency(card.debt)} –≥—Ä–Ω</p>` : `<p class="text-sm opacity-80">**** ${card.number}</p>`}
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-extrabold">${formatCurrency(card.balance)} –≥—Ä–Ω</p>
                            <button onclick="openCardSettings(${card.id})" class="text-xs mt-1 underline opacity-70 hover:opacity-100 transition">
                                –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏
                            </button>
                        </div>
                    </div>
                `;
                list.innerHTML += cardHtml;
            });
        }
        
        function renderTransactions() {
            const list = document.getElementById('transactions-list');
            list.innerHTML = ''; 
            
            const transactionsToShow = transactions.slice(0, 5);

            transactionsToShow.forEach(tx => {
                const isDebit = tx.amount < 0;
                const sign = isDebit ? '' : '+';
                
                const formattedAmount = `${sign}${Math.abs(tx.amount).toLocaleString('uk-UA', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                })}`;
                
                const cardInfo = tx.cardName ? ` | ${tx.cardName}` : '';

                const transactionHtml = `
                    <div onclick="showTransactionDetails(${tx.id})" 
                         class="flex justify-between items-center p-3 hover:bg-gray-50 rounded-lg cursor-pointer transition">
                        
                        <!-- Icon and Name -->
                        <div class="flex items-center space-x-3">
                            <div class="text-xl">${tx.icon}</div>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">${tx.name}</p>
                                <p class="text-xs text-gray-500">${tx.date} ${cardInfo}</p>
                            </div>
                        </div>

                        <!-- Amount -->
                        <div class="text-right">
                            <p class="text-sm font-bold ${isDebit ? 'text-red-600' : 'text-green-600'}">
                                ${formattedAmount} –≥—Ä–Ω
                            </p>
                            <p class="text-xs text-gray-400">–ö–∞—Ä—Ç–∫–∞</p>
                        </div>
                    </div>
                `;
                list.innerHTML += transactionHtml;
            });

            if (transactions.length > 5 && list.children.length === 5) {
                list.innerHTML += `
                    <div class="pt-2 text-center">
                        <button onclick="openHistoryPage()" class="text-sm text-blue-600 font-semibold hover:underline">
                            –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ ${transactions.length} —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
                        </button>
                    </div>
                `;
            }
        }

        function renderFullTransactions() {
            const list = document.getElementById('full-transactions-list');
            if (!list) return;

            list.innerHTML = ''; 
            
            transactions.forEach(tx => {
                const isDebit = tx.amount < 0;
                const sign = isDebit ? '' : '+';
                
                const formattedAmount = `${sign}${Math.abs(tx.amount).toLocaleString('uk-UA', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                })}`;
                
                const cardInfo = tx.cardName ? ` | ${tx.cardName}` : '';

                const transactionHtml = `
                    <div onclick="showTransactionDetails(${tx.id})" 
                         class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm cursor-pointer hover:bg-gray-100 transition">
                        
                        <!-- Icon and Name -->
                        <div class="flex items-center space-x-3">
                            <div class="text-xl">${tx.icon}</div>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">${tx.name}</p>
                                <p class="text-xs text-gray-500">${tx.date} ${cardInfo}</p>
                            </div>
                        </div>

                        <!-- Amount -->
                        <div class="text-right">
                            <p class="text-base font-bold ${isDebit ? 'text-red-600' : 'text-green-600'}">
                                ${formattedAmount} –≥—Ä–Ω
                            </p>
                            <p class="text-xs text-gray-400">${tx.transactionId}</p>
                        </div>
                    </div>
                `;
                list.innerHTML += transactionHtml;
            });
        }

        function renderChatHistory() {
            const list = document.getElementById('chat-history');
            if (!list) return;
            list.innerHTML = '';
            
            chatHistory.forEach(msg => {
                const isManager = msg.sender === 'manager';
                const alignment = isManager ? 'justify-start' : 'justify-end';
                const bubbleClass = isManager ? 'manager-message' : 'user-message';

                const html = `
                    <div class="flex ${alignment}">
                        <div class="message-bubble ${bubbleClass} shadow-md">
                            ${msg.text}
                            <div class="text-right text-xs mt-1 opacity-70">${isManager ? '–ú–µ–Ω–µ–¥–∂–µ—Ä' : '–í–∏'}</div>
                        </div>
                    </div>
                `;
                list.innerHTML += html;
            });
            scrollToChatBottom();
        }
        
        function scrollToChatBottom() {
            const chatHistoryElement = document.getElementById('chat-history');
            if (chatHistoryElement) {
                chatHistoryElement.scrollTop = chatHistoryElement.scrollHeight;
            }
        }
        
        function generateManagerResponse(userMessage) {
            const lowMsg = userMessage.toLowerCase();

            if (lowMsg.includes('–±–∞–ª–∞–Ω—Å') || lowMsg.includes('—Ä–∞—Ö—É–Ω–æ–∫')) {
                return '–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å—É –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ–π –∫–∞—Ä—Ç—Ü—ñ, –±—É–¥—å –ª–∞—Å–∫–∞, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—å –≥–æ–ª–æ–≤–Ω–∏–º –µ–∫—Ä–∞–Ω–æ–º –¥–æ–¥–∞—Ç–∫—É –∞–±–æ –Ω–∞—à–æ—é –≥–æ–ª–æ—Å–æ–≤–æ—é –ª—ñ–Ω—ñ—î—é.';
            }
            if (lowMsg.includes('–ø–µ—Ä–µ–∫–∞–∑') || lowMsg.includes('–ø–ª–∞—Ç—ñ–∂')) {
                return '–í–∏ –º–æ–∂–µ—Ç–µ –∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –ø–µ—Ä–µ–∫–∞–∑, –Ω–∞—Ç–∏—Å–Ω—É–≤—à–∏ –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–∫–∞–∑" –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ. –ü–µ—Ä–µ–∫–∞–∑–∏ –∑–∞–π–º–∞—é—Ç—å –¥–æ 5 —Ö–≤–∏–ª–∏–Ω.';
            }
            if (lowMsg.includes('–∫—Ä–µ–¥–∏—Ç')) {
                const creditCard = cards.find(c => c.id === 3);
                if (creditCard && creditCard.debt > 0) {
                     return `–í–∏ –º–∞—î—Ç–µ –∞–∫—Ç–∏–≤–Ω–∏–π –±–æ—Ä–≥ ${formatCurrency(creditCard.debt)} –≥—Ä–Ω. –í–∏ –º–æ–∂–µ—Ç–µ –≤–Ω–µ—Å—Ç–∏ –ø–ª–∞—Ç—ñ–∂ —á–µ—Ä–µ–∑ "–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è" –Ω–∞ –∫—Ä–µ–¥–∏—Ç–Ω—ñ–π –∫–∞—Ä—Ç—Ü—ñ.`;
                }
                return '–ó–∞—è–≤–∫—É –Ω–∞ –∫—Ä–µ–¥–∏—Ç –º–æ–∂–Ω–∞ –ø–æ–¥–∞—Ç–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–ö—Ä–µ–¥–∏—Ç" –Ω–∞ –≥–æ–ª–æ–≤–Ω–æ–º—É –µ–∫—Ä–∞–Ω—ñ. –ú–∏ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ —ó—ó –ø—Ä–æ—Ç—è–≥–æ–º 15 —Ö–≤–∏–ª–∏–Ω.';
            }

            return '–î—è–∫—É—é –∑–∞ –≤–∞—à–µ –ø–∏—Ç–∞–Ω–Ω—è. –©–æ–± –Ω–∞–¥–∞—Ç–∏ —Ç–æ—á–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å, –º–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ —É—Ç–æ—á–Ω–∏—Ç–∏ –¥–µ—Ç–∞–ª—ñ. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è, –±—É–¥—å –ª–∞—Å–∫–∞, –Ω–∞ –≥–∞—Ä—è—á—É –ª—ñ–Ω—ñ—é –∞–±–æ –¥–æ —Ñ–∞—Ö—ñ–≤—Ü—è.';
        }

        // --- Event Handlers (retained) ---
        
        function handleChatSubmit(event) {
            event.preventDefault();
            const input = document.getElementById('chat-input');
            const userMessage = input.value.trim();

            if (!userMessage) return;

            chatHistory.push({ sender: 'user', text: userMessage });
            renderChatHistory();
            
            input.value = '';
            
            setTimeout(() => {
                const managerResponse = generateManagerResponse(userMessage);
                chatHistory.push({ sender: 'manager', text: managerResponse });
                renderChatHistory();
            }, 1000);
        }
        
        function openCardsPage() {
            openModal('cards');
        }

        function openHistoryPage() {
            openModal('history');
        }
        
        function openChatPage() {
            openModal('chat');
            setTimeout(scrollToChatBottom, 300);
        }

        function openCreditModal() {
            updateCreditModalInfo();
            openModal('credit');
        }

        function updateCreditModalInfo() {
            const creditCard = cards.find(c => c.id === 3);
            const infoDiv = document.getElementById('credit-info');
            const debt = creditCard.debt;
            const availableLimit = creditCard.creditLimit - debt;
            const availableFunds = creditCard.balance;

            let statusHtml;
            let formState = '';

            if (debt > 0) {
                statusHtml = `
                    <p class="font-bold text-lg text-red-600">–ê–∫—Ç–∏–≤–Ω–∏–π –ö—Ä–µ–¥–∏—Ç</p>
                    <p>–ü–æ—Ç–æ—á–Ω–∞ –ó–∞–±–æ—Ä–≥–æ–≤–∞–Ω—ñ—Å—Ç—å: <span class="font-bold">${formatCurrency(debt)} –≥—Ä–Ω</span></p>
                    <p>–î–æ—Å—Ç—É–ø–Ω–∏–π –õ—ñ–º—ñ—Ç: <span class="font-bold">${formatCurrency(Math.max(0, availableLimit))} –≥—Ä–Ω</span></p>
                    <p class="text-sm mt-1">–ù–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤: 1% –≤—ñ–¥ –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —Å—É–º–∏ –∫–æ–∂–Ω—É —Ö–≤–∏–ª–∏–Ω—É.</p>
                `;
                formState = 'hidden';
            } else {
                 statusHtml = `
                    <p class="font-bold text-lg text-green-600">–ö—Ä–µ–¥–∏—Ç–Ω–∏–π –õ—ñ–º—ñ—Ç</p>
                    <p>–ó–∞–≥–∞–ª—å–Ω–∏–π –õ—ñ–º—ñ—Ç: <span class="font-bold">${formatCurrency(creditCard.creditLimit)} –≥—Ä–Ω</span></p>
                    <p>–í–∞—à–∞ –ó–∞–±–æ—Ä–≥–æ–≤–∞–Ω—ñ—Å—Ç—å: <span class="font-bold">0.00 –≥—Ä–Ω</span></p>
                `;
            }
            
            if (infoDiv) infoDiv.innerHTML = statusHtml;
            const creditForm = document.getElementById('credit-form');
            const submitBtn = document.getElementById('submit-credit-btn');
            
            if (creditForm) creditForm.classList.toggle('hidden', debt > 0);
            if (submitBtn) submitBtn.disabled = debt > 0;
            
        }

        function selectCardColor(button) {
            const color = button.getAttribute('data-color');
            const containerId = button.closest('#color-options') ? 'settings' : 'newcard';
            
            document.querySelectorAll(`#${containerId}-color-options button`).forEach(btn => {
                btn.classList.remove('border-white', 'border-gray-400');
                btn.classList.add('border-gray-400');
            });
            
            button.classList.remove('border-gray-400');
            button.classList.add('border-white');

            document.getElementById(`${containerId}-color`).value = color;
        }

        function selectNewCardColor(button) {
             selectCardColor(button);
        }
        
        function toggleAuthMode() {
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const authTitle = document.getElementById('auth-title');
            const switchBtn = document.getElementById('auth-switch-btn');

            if (loginForm.classList.contains('hidden')) {
                // –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –í—Ö–æ–¥—É
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                authTitle.textContent = '–í—Ö—ñ–¥ –≤ –∞–∫–∞—É–Ω—Ç';
                switchBtn.innerHTML = '–ù–µ –º–∞—î—Ç–µ –∞–∫–∞—É–Ω—Ç—É? **–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è**';
            } else {
                // –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
                authTitle.textContent = '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–∫–∞—É–Ω—Ç—É';
                switchBtn.innerHTML = '–í–∂–µ —î –∞–∫–∞—É–Ω—Ç? **–£–≤—ñ–π—Ç–∏**';
            }
        }
        
        function handleSignup(event) {
            event.preventDefault();
            const form = event.target;
            const nick = form.elements['nick'].value.trim();
            const password = form.elements['password'].value;
            const errorElement = document.getElementById('signup-error');

            if (mockUsers.some(u => u.nick === nick)) {
                errorElement.classList.remove('hidden');
                return;
            }
            errorElement.classList.add('hidden');

            const newUser = { nick, password };
            mockUsers.push(newUser);
            currentUser = newUser;
            saveAuthState();
            
            handleNotification(`–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞! –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ, ${nick}!`, 3000);
            closeModal();
            renderHeaderButton();
        }

        function handleLogin(event) {
            event.preventDefault();
            const form = event.target;
            const nick = form.elements['nick'].value.trim();
            const password = form.elements['password'].value;
            const errorElement = document.getElementById('login-error');

            const user = mockUsers.find(u => u.nick === nick && u.password === password);

            if (!user) {
                errorElement.classList.remove('hidden');
                return;
            }
            errorElement.classList.add('hidden');

            currentUser = user;
            saveAuthState();
            
            handleNotification(`–í—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π! –í—ñ—Ç–∞—î–º–æ, ${nick}!`, 3000);
            closeModal();
            renderHeaderButton();
        }

    </script>

</body>
</html>
